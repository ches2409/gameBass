{% extends 'layout.html' %}

{% block title %}
	Command suite
{% endblock %}

{% block content %}
	<div class="command-center">
        <div class="command-center__sidebar">
            <!-- Bloque 'command-suite': Componente de navegación -->
            <div class="command-suite">

                <div class="command-suite__header">
                    <div class="command-suite__wrapper">
                        <div class="command-suite__logo iso-logo"></div>
                        <div class="command-suite__branding">
                            <div class="command-suite__title">
                                <h1>Arkadex</h1>
                            </div>
                            <div class="command-suite__tag">
                                <p>command_suite</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="command-suite__main">

                    {# Bucle simplificado: Itera sobre las secciones ya agrupadas desde el backend #}
                    {# Si una sección no tiene ítems, simplemente no estará en 'menu_data' #}
                    {% for section in menu_data %}
                        {# Pasamos el título y los ítems de esta sección específica al componente #}
                        {% with name_section=section.title, items_in_section=section.section_items %}
                            {% include 'components/main_menu.html' %}
                        {% endwith %}
                    {% endfor %}

                </div>

                <div class="command-suite__footer">
                    <div class="command-suite__group clip-btn">
                        <a href="{{ url_for('auth.logout') }}" class="button-abort" style="text-decoration: none; color: inherit; width: 100%;">
                            <div class="icon_abort">

                                <span class="material-symbols-outlined card-bg-icon">logout</span>

                            </div>
                            <p class="text_abort">ABORT_SYSTEM</p>
                        </a>
                    </div>
                </div>

            </div>
        </div>

        <div class="command-center__viewport">

            <div class="command-center__title-bar">

                <div class="title-breadcrumbs">
                    <div class="command-center__routes routes">
                        <div class="icon_routes">

                            <span class="material-symbols-outlined card-bg-icon">terminal</span>

                        </div>
                        <div class="text_routes">
                            <P class="text_code">ARKADEX_SYSTEM_0X92 // </P>
                            <p class="status-code">SECTOR_ACCESS_GRANTED:</p>
                        </div>

                        <div class="route">
                            <P class="text_normal">{{ page_data }}</P>
                        </div>

                    </div>

                </div>

                <div class="sync-status">
                    <!-- Contenedor del icono con doble capa -->
                    <div class="icon-pulse">
                        <span class="material-symbols-outlined ping-layer">sensors</span>
                        <span class="material-symbols-outlined blink-layer">sensors</span>
                    </div>

                    <!-- Texto de estado -->
                    <span class="sync-text">
                    CORE_SYNC: <span class="status-optimal">OPTIMAL</span>
                    </span>
                </div>

                <div class="user">
                    <div class="header-actions">
                        <!-- Divisor técnico vertical -->
                        <div class="vertical-divider"></div>

                        <!-- Información del Operador (Solo si está logueado) -->
                        {% if current_user.is_authenticated %}
                            <div class="operator-info" style="text-align: right; margin-right: 15px;">
                                <p class="text_code" style="margin:0; color: #A3FF00; font-weight: bold;">{{ current_user.alias_usuario }}</p>
                                <p class="status-code" style="margin:0; font-size: 8px; opacity: 0.7;">{{ current_user.jerarquia.nombre_jerarquia | upper }}</p>
                                <P class="status-code text-3xs">{{ user_perfil }}</P>
                            </div>

                            <!-- Botón de Perfil Neural (Ahora con Avatar y Logout) -->
                            <a href="{{ url_for('auth.logout') }}" class="profile-trigger" title="CERRAR ENLACE NEURAL (LOGOUT)" style="text-decoration: none; padding: 0;">
                                <div class="trigger-overlay"></div>
                                
                                {# Lógica de Avatar Inteligente #}
                                {% if current_user.foto_usuario %}
                                    {% if current_user.foto_usuario.startswith('http') %}
                                        <img src="{{ current_user.foto_usuario }}" class="user-icon" style="width: 100%; height: 100%; object-fit: cover; border-radius: 0;">
                                    {% else %}
                                        <img src="{{ url_for('static', filename='uploads/avatars/' ~ current_user.foto_usuario) }}" class="user-icon" style="width: 100%; height: 100%; object-fit: cover; border-radius: 0;">
                                    {% endif %}
                                {% else %}
                                    <img src="https://api.dicebear.com/9.x/bottts-neutral/svg?seed={{ current_user.alias_usuario }}" class="user-icon" style="width: 100%; height: 100%; object-fit: cover; border-radius: 0;">
                                {% endif %}

                                <!-- Elementos decorativos de esquina -->
                                <div class="corner-accent"></div>
                            </a>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="command-center__body">

                {# --- INYECCIÓN DE MENSAJES FLASH --- #}
                {% include 'components/flash_messages.html' %}


                {% block dashboard_body %}
                <div class="intro_card">

                    <div class="intro_main">


    {#                        contenido del banner#}

                        <div class="command">

                            <div class="command__code intel-badge">
                                <p class="text_code">INTELLIGENCE_STREAM_0X82</p>
                            </div>

                            <div class="command__link">
                                <div class="text_link">
                                    <p class="text_code">LINK:</p>
                                </div>

                                <div class="type_command">
                                    <p class="text_normal">ENCRYPTED_MASTERMODE</p>
                                </div>
                            </div>

                        </div>

                        <!-- Título Principal con Atributo de Datos para el Glitch -->
                        <h2 class="glitch-title" data-text={{ page_title }}>
                            {{ page_title }}
                        </h2>



                    </div>

                    <div class="intro_status">
                        <div class="metrics-container">
                            <!-- Reloj del Sistema -->
                            <p class="system-clock">
                                LOCAL_CLOCK: <span class="clock-value">14:20:05</span>
                            </p>

                            <!-- Latencia de Sincronización -->
                            <div class="sync-delay">
                                <span class="delay-label">SYNC_DELAY:</span>
                                <span class="delay-value">0.024ms</span>
                            </div>
                        </div>
                    </div>

                </div>

    {#                Tarjetas de mainHub metricas#}

                <div class="metric-card">
                    {% block metricCard %}
                        {% for card in metric_cards %}
                            {% with label=card.label, value=card.value, trend=card.trend, icon=card.icon, color_class=card.color_class %}
                                {% include 'components/metric-card.html' %}
                            {% endwith %}
                        {% endfor %}
                    {% endblock %}
                </div>

                <div class="tactical-card">
                    {% block tacticalCard %}
                        {% include 'components/tactical-card.html' %}
                    {% endblock %}
                </div>

                <div class="subjects-card">
                {% block subjectCard %}
                    {% include 'components/subjects-card.html' %}
                {% endblock %}
                </div>
                {% endblock %}

            </div>

            <div class="command-center__footer">
                {% include 'components/status-bar.html' %}
            </div>

        </div>

    </div>
{% endblock %}