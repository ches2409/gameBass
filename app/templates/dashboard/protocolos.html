{% extends 'dashboard/index.html' %}

{% block title %}Protocolos | Arkadex{% endblock %}

{% block dashboard_body %}
	{% block alertContainer %}

        <!-- Si existe una alerta específica para esta URL (alert_finish), la mostramos -->
        {% if alert_finish %}
            {% with icon=alert_finish.icon, title=alert_finish.title, subtitle=alert_finish.subtitle, btn_info=alert_finish.btn_info, modal_target='createProtocolModal' %}
                {% include 'components/alert-container.html' %}
            {% endwith %}
        {% endif %}

    {% endblock %}

    <div class="intro_card mb-4">
        <div class="intro_main w-100">
            <div class="command">
                <div class="command__code intel-badge">
                    <p class="text_code">SYSTEM_CONFIG_0X01</p>
                </div>
            </div>

            <!-- Título Principal con Atributo de Datos para el Glitch -->
            <h2 class="glitch-title font-display" data-text="{{ page_title }}">
                {{ page_title }}
            </h2>

        </div>
    </div>

    <div class="protocolos_card">

        {% block protocolsCard %}
        	{% include 'components/protocols-card.html' %}
        {% endblock %}

    </div>

    {% include 'dashboard/protocolos/create.html' %}
    {% include 'dashboard/protocolos/update.html' %}
    {% include 'components/delete-modal.html' %}

    <script>
        function toggleModal(modalID) {
            const modal = document.getElementById(modalID);
            if (modal) {
                // Si usas display: none en CSS
                if (modal.style.display === "none" || modal.style.display === "") {
                    modal.style.display = "flex";
                } else {
                    modal.style.display = "none";
                }
                // O si usas una clase .active en tu CSS:
                // modal.classList.toggle('active');
            }
        }

        function openUpdateModal(button) {
            // 1. Obtener datos del botón
            const id = button.getAttribute('data-id');
            const nombre = button.getAttribute('data-nombre');
            const codigo = button.getAttribute('data-codigo');
            const categoria = button.getAttribute('data-categoria');
            const descripcion = button.getAttribute('data-descripcion');

            // 2. Construir la URL de actualización dinámicamente
            // Usamos un ID '0' temporal para que Flask genere la base de la URL, y luego lo reemplazamos
            const baseUrlProtocol = "{{ url_for('protocolo.update', id_protocolo=0) }}";
            const updateUrlProtocol = baseUrlProtocol.replace('0', id);

            // 3. Asignar al formulario y a los inputs
            document.getElementById('formUpdateProtocolo').action = updateUrlProtocol;
            document.getElementById('inputNombreProtocolo').value = nombre;
            document.getElementById('inputCodigoProtocolo').value = codigo;
            document.getElementById('inputCategoriaProtocolo').value = categoria;
            document.getElementById('inputDescripcionProtocolo').value = descripcion;

            // 4. Abrir el modal
            toggleModal('updateProtocolModal');
        }

        function openDeleteModal(deleteUrl, itemName) {
            // 1. Actualizar el enlace del botón de confirmación
            document.getElementById('btnConfirmPurge').href = deleteUrl;

            // 2. Mostrar el nombre del item (protocolo) en la advertencia
            document.getElementById('deleteItemName').textContent = itemName;

            // 3. Abrir el modal
            toggleModal('deleteConfirmationModal');
        }


    </script>

{% endblock %}